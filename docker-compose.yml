version: "3.8"

services:
  backend:
    build: ./backend
    container_name: intpatient-backend
    ports:
      - "8000:8000"
    volumes:
      - ./uploads:/app/uploads
      - ./intpatient.db:/app/intpatient.db
    environment:
      - UPPERMIND_URL=${UPPERMIND_URL:-http://10.10.0.149:3000}
      - OLLAMA_URL=${OLLAMA_URL:-http://host.docker.internal:11434}
      - OLLAMA_MODEL=${OLLAMA_MODEL:-deepseek-ocr}
      - TRANSLATOR_AGENT_ID=${TRANSLATOR_AGENT_ID:-1}
      - UPLOAD_DIR=/app/uploads
      - DATABASE_URL=sqlite:////app/intpatient.db
      - MAX_UPLOAD_SIZE_MB=${MAX_UPLOAD_SIZE_MB:-50}
      - CORS_ORIGINS=${CORS_ORIGINS:-http://localhost}
    extra_hosts:
      - "host.docker.internal:host-gateway"
    restart: unless-stopped

  frontend:
    build: ./frontend
    container_name: intpatient-frontend
    ports:
      - "80:80"
    depends_on:
      - backend
    restart: unless-stopped
